{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/aws-bootcamp-cruddur-2023/frontend-react-js/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/workspace/aws-bootcamp-cruddur-2023/frontend-react-js/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/workspace/aws-bootcamp-cruddur-2023/frontend-react-js/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import'./MessageGroupPage.css';import React from\"react\";import{useParams}from'react-router-dom';import DesktopNavigation from'../components/DesktopNavigation';import MessageGroupFeed from'../components/MessageGroupFeed';import MessagesFeed from'../components/MessageFeed';import MessagesForm from'../components/MessageForm';import checkAuth from'../lib/CheckAuth';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function MessageGroupPage(){var _React$useState=React.useState([]),_React$useState2=_slicedToArray(_React$useState,2),otherUser=_React$useState2[0],setOtherUser=_React$useState2[1];var _React$useState3=React.useState([]),_React$useState4=_slicedToArray(_React$useState3,2),messageGroups=_React$useState4[0],setMessageGroups=_React$useState4[1];var _React$useState5=React.useState([]),_React$useState6=_slicedToArray(_React$useState5,2),messages=_React$useState6[0],setMessages=_React$useState6[1];var _React$useState7=React.useState([]),_React$useState8=_slicedToArray(_React$useState7,2),popped=_React$useState8[0],setPopped=_React$useState8[1];var _React$useState9=React.useState(null),_React$useState10=_slicedToArray(_React$useState9,2),user=_React$useState10[0],setUser=_React$useState10[1];var dataFetchedRef=React.useRef(false);var params=useParams();var loadUserShortData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var backend_url,res,resJson;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;backend_url=\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/api/users/@\").concat(params.handle,\"/short\");_context.next=4;return fetch(backend_url,{method:\"GET\"});case 4:res=_context.sent;_context.next=7;return res.json();case 7:resJson=_context.sent;if(res.status===200){console.log('other user:',resJson);setOtherUser(resJson);}else{console.log(res);}_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function loadUserShortData(){return _ref.apply(this,arguments);};}();var loadMessageGroupsData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var backend_url,res,resJson;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;backend_url=\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/api/message_groups\");_context2.next=4;return fetch(backend_url,{headers:{Authorization:\"Bearer \".concat(localStorage.getItem(\"access_token\"))},method:\"GET\"});case 4:res=_context2.sent;_context2.next=7;return res.json();case 7:resJson=_context2.sent;if(res.status===200){setMessageGroups(resJson);}else{console.log(res);}_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,11]]);}));return function loadMessageGroupsData(){return _ref2.apply(this,arguments);};}();React.useEffect(function(){//prevents double call\nif(dataFetchedRef.current)return;dataFetchedRef.current=true;loadMessageGroupsData();loadUserShortData();checkAuth(setUser);},[]);return/*#__PURE__*/_jsxs(\"article\",{children:[/*#__PURE__*/_jsx(DesktopNavigation,{user:user,active:'home',setPopped:setPopped}),/*#__PURE__*/_jsx(\"section\",{className:\"message_groups\",children:/*#__PURE__*/_jsx(MessageGroupFeed,{otherUser:otherUser,message_groups:messageGroups})}),/*#__PURE__*/_jsxs(\"div\",{className:\"content messages\",children:[/*#__PURE__*/_jsx(MessagesFeed,{messages:messages}),/*#__PURE__*/_jsx(MessagesForm,{setMessages:setMessages})]})]});}","map":{"version":3,"names":["React","useParams","DesktopNavigation","MessageGroupFeed","MessagesFeed","MessagesForm","checkAuth","MessageGroupPage","useState","otherUser","setOtherUser","messageGroups","setMessageGroups","messages","setMessages","popped","setPopped","user","setUser","dataFetchedRef","useRef","params","loadUserShortData","backend_url","process","env","REACT_APP_BACKEND_URL","handle","fetch","method","res","json","resJson","status","console","log","loadMessageGroupsData","headers","Authorization","localStorage","getItem","useEffect","current"],"sources":["/workspace/aws-bootcamp-cruddur-2023/frontend-react-js/src/pages/MessageGroupNewPage.js"],"sourcesContent":["import './MessageGroupPage.css';\nimport React from \"react\";\nimport { useParams } from 'react-router-dom';\n\nimport DesktopNavigation  from '../components/DesktopNavigation';\nimport MessageGroupFeed from '../components/MessageGroupFeed';\nimport MessagesFeed from '../components/MessageFeed';\nimport MessagesForm from '../components/MessageForm';\nimport checkAuth from '../lib/CheckAuth';\n\nexport default function MessageGroupPage() {\n  const [otherUser, setOtherUser] = React.useState([]);\n  const [messageGroups, setMessageGroups] = React.useState([]);\n  const [messages, setMessages] = React.useState([]);\n  const [popped, setPopped] = React.useState([]);\n  const [user, setUser] = React.useState(null);\n  const dataFetchedRef = React.useRef(false);\n  const params = useParams();\n\n  const loadUserShortData = async () => {\n    try {\n      const backend_url = `${process.env.REACT_APP_BACKEND_URL}/api/users/@${params.handle}/short`\n      const res = await fetch(backend_url, {\n        method: \"GET\"\n      });\n      let resJson = await res.json();\n      if (res.status === 200) {\n        console.log('other user:',resJson)\n        setOtherUser(resJson)\n      } else {\n        console.log(res)\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  };  \n\n  const loadMessageGroupsData = async () => {\n    try {\n      const backend_url = `${process.env.REACT_APP_BACKEND_URL}/api/message_groups`\n      const res = await fetch(backend_url, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"access_token\")}`\n        },\n        method: \"GET\"\n      });\n      let resJson = await res.json();\n      if (res.status === 200) {\n        setMessageGroups(resJson)\n      } else {\n        console.log(res)\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  };  \n\n  React.useEffect(()=>{\n    //prevents double call\n    if (dataFetchedRef.current) return;\n    dataFetchedRef.current = true;\n\n    loadMessageGroupsData();\n    loadUserShortData();\n    checkAuth(setUser);\n  }, [])\n  return (\n    <article>\n      <DesktopNavigation user={user} active={'home'} setPopped={setPopped} />\n      <section className='message_groups'>\n        <MessageGroupFeed otherUser={otherUser} message_groups={messageGroups} />\n      </section>\n      <div className='content messages'>\n        <MessagesFeed messages={messages} />\n        <MessagesForm setMessages={setMessages} />\n      </div>\n    </article>\n  );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}