{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/aws-bootcamp-cruddur-2023/frontend-react-js/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/workspace/aws-bootcamp-cruddur-2023/frontend-react-js/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/workspace/aws-bootcamp-cruddur-2023/frontend-react-js/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/workspace/aws-bootcamp-cruddur-2023/frontend-react-js/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import'./MessageForm.css';import React from\"react\";import process from'process';import{json,useParams}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ActivityForm(props){var _React$useState=React.useState(0),_React$useState2=_slicedToArray(_React$useState,2),count=_React$useState2[0],setCount=_React$useState2[1];var _React$useState3=React.useState(''),_React$useState4=_slicedToArray(_React$useState3,2),message=_React$useState4[0],setMessage=_React$useState4[1];var params=useParams();var classes=[];classes.push('count');if(1024-count<0){classes.push('err');}var onsubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event){var backend_url,_json,res,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();_context.prev=1;backend_url=\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/api/messages\");console.log('onsubmit payload',message);_json={'message':message};if(params.handle){_json.handle=params.handle;}else{_json.message_group_uuid=params.message_group_uuid;}_context.next=8;return fetch(backend_url,{method:\"POST\",headers:{'Authorization':\"Bearer \".concat(localStorage.getItem(\"access_token\")),'Accept':'application/json','Content-Type':'application/json'},body:JSON.stringify(_json)});case 8:res=_context.sent;_context.next=11;return res.json();case 11:data=_context.sent;if(res.status===200){console.log('data:',data);if(data.message_group_uuid){console.log('redirect to message group');window.location.href=\"/messages/\".concat(data.message_group_uuid);}else{props.setMessages(function(current){return[].concat(_toConsumableArray(current),[data]);});}}else{console.log(res);}_context.next=18;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 18:case\"end\":return _context.stop();}}},_callee,null,[[1,15]]);}));return function onsubmit(_x){return _ref.apply(this,arguments);};}();var textarea_onchange=function textarea_onchange(event){setCount(event.target.value.length);setMessage(event.target.value);};return/*#__PURE__*/_jsxs(\"form\",{className:\"message_form\",onSubmit:onsubmit,children:[/*#__PURE__*/_jsx(\"textarea\",{type:\"text\",placeholder:\"send a direct message...\",value:message,onChange:textarea_onchange}),/*#__PURE__*/_jsxs(\"div\",{className:\"submit\",children:[/*#__PURE__*/_jsx(\"div\",{className:classes.join(' '),children:1024-count}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Message\"})]})]});}","map":{"version":3,"names":["React","process","json","useParams","ActivityForm","props","useState","count","setCount","message","setMessage","params","classes","push","onsubmit","event","preventDefault","backend_url","env","REACT_APP_BACKEND_URL","console","log","handle","message_group_uuid","fetch","method","headers","localStorage","getItem","body","JSON","stringify","res","data","status","window","location","href","setMessages","current","textarea_onchange","target","value","length","join"],"sources":["/workspace/aws-bootcamp-cruddur-2023/frontend-react-js/src/components/MessageForm.js"],"sourcesContent":["import './MessageForm.css';\nimport React from \"react\";\nimport process from 'process';\nimport { json, useParams } from 'react-router-dom';\n\nexport default function ActivityForm(props) {\n  const [count, setCount] = React.useState(0);\n  const [message, setMessage] = React.useState('');\n  const params = useParams();\n\n  const classes = []\n  classes.push('count')\n  if (1024-count < 0){\n    classes.push('err')\n  }\n\n  const onsubmit = async (event) => {\n    event.preventDefault();\n    try {\n      const backend_url = `${process.env.REACT_APP_BACKEND_URL}/api/messages`\n      console.log('onsubmit payload', message)\n      let json = { 'message': message }\n      if (params.handle) {\n        json.handle = params.handle\n      } else {\n        json.message_group_uuid = params.message_group_uuid\n      }\n\n      const res = await fetch(backend_url, {\n        method: \"POST\",\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem(\"access_token\")}`,\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(json)\n      });\n      let data = await res.json();\n      if (res.status === 200) {\n        console.log('data:',data)\n        if (data.message_group_uuid) {\n          console.log('redirect to message group')\n          window.location.href = `/messages/${data.message_group_uuid}`\n        } else {\n          props.setMessages(current => [...current,data]);\n        }\n      } else {\n        console.log(res)\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  }\n\n  const textarea_onchange = (event) => {\n    setCount(event.target.value.length);\n    setMessage(event.target.value);\n  }\n\n  return (\n    <form \n      className='message_form'\n      onSubmit={onsubmit}\n    >\n      <textarea\n        type=\"text\"\n        placeholder=\"send a direct message...\"\n        value={message}\n        onChange={textarea_onchange} \n      />\n      <div className='submit'>\n        <div className={classes.join(' ')}>{1024-count}</div>\n        <button type='submit'>Message</button>\n      </div>\n    </form>\n  );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}